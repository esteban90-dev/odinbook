<div class="row mt-5 mb-3">
  <div class="col text-center">
    <h2>Users</h2>
  </div>
</div>

<div class="row justify-content-center">
  <div class="col-5 px-3 py-3 shadow bg-white rounded">
  
    <% @users.each do |user| %>
      <div data-test="user-<%= user.id %>">

        <div class="row mx-3 my-3 px-2 py-2 shadow-sm rounded">
          <div class="col-2">
            <%= image_tag user.profile.picture.variant(resize_to_limit: [75,75]), class: "rounded-circle" %>
          </div>

          <div class="col-6 my-auto">
            <h5><%= link_to user.name, user_profile_path(user.id), class: "link-dark" %></h5>
          </div>

          <div class="col-4 text-center my-auto">
            <% if current_user.friends.include?(user) %>
              <b>friends</b>

            <% elsif current_user.sent_friend_requests.map{ |fr| fr.requestee }.include?(user) %>
              <b>friend request sent</b>

            <% elsif current_user.incoming_friend_requests.map{ |fr| fr.requestor }.include?(user) %>
              <% fr = current_user.incoming_friend_requests.where(requestor: user).first %>
              <%= link_to "accept", accept_friend_request_path(fr.id), method: :delete, class: "btn btn-primary" %>
              <%= link_to "ignore", ignore_friend_request_path(fr.id), method: :delete, class: "btn btn-primary" %>

            <% else %>
              <%= link_to friend_requests_path("friend_request" => { requestee_id: user.id } ), data: { test: "add-friend" }, method: :post do %>
                <i class="fas fa-user-plus"></i>
              <% end %>

            <% end %>
          </div>
      </div>
    <% end %>
  </div>
</div>